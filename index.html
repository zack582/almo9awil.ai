<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" /> 
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>محرك البحث — المقاول</title>
  <meta name="color-scheme" content="light dark" />
  <meta name="description" content="محرك بحث ذكي للمقاولين والأعمال التجارية" />
  <meta name="keywords" content="مقاول، أعمال، بحث، ذكي، عربي" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;500;600;700;800;900&display=swap');

    :root {
      --bg: linear-gradient(135deg, #0a0a1a 0%, #1a1a3a 100%);
      --bg-noise: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.03'/%3E%3C/svg%3E");
      --glass: rgba(255, 255, 255, 0.03);
      --glass-border: rgba(255, 255, 255, 0.08);
      --glass-hover: rgba(255, 255, 255, 0.06);
      --text: #f8fafc;
      --text-muted: #94a3b8;
      --accent: #3b82f6;
      --accent-rgb: 59, 130, 246;
      --accent-2: #60a5fa;
      --success: #10b981;
      --error: #ef4444;
      --border: rgba(148, 163, 184, 0.12);
      --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      --shadow-xl: 0 25px 50px rgba(0, 0, 0, 0.25);
      --radius: 20px;
      --radius-xl: 28px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
      font-family: 'Cairo', -apple-system, BlinkMacSystemFont, sans-serif;
      overflow-x: hidden;
      scroll-behavior: smooth;
    }

    body {
      background: var(--bg), var(--bg-noise);
      background-attachment: fixed;
      color: var(--text);
      direction: rtl;
      text-align: right;
      line-height: 1.7;
      position: relative;
    }

    /* Animated mesh background */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 25% 25%, rgba(var(--accent-rgb), 0.08) 0%, transparent 50%),
        radial-gradient(circle at 75% 75%, rgba(96, 165, 250, 0.06) 0%, transparent 50%),
        radial-gradient(circle at 50% 50%, rgba(var(--accent-rgb), 0.04) 0%, transparent 50%);
      animation: mesh-float 20s ease-in-out infinite;
      pointer-events: none;
      z-index: -1;
    }

    @keyframes mesh-float {
      0%, 100% { 
        transform: translate(0, 0) scale(1); 
        opacity: 1; 
      }
      33% { 
        transform: translate(30px, -30px) scale(1.02); 
        opacity: 0.8; 
      }
      66% { 
        transform: translate(-20px, 20px) scale(0.98); 
        opacity: 0.9; 
      }
    }

    /* Modern container */
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 24px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      position: relative;
    }

    /* Enhanced header */
    .header {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 60px 0 40px;
      position: relative;
    }

    .brand {
      display: flex;
      gap: 32px;
      align-items: center;
      flex-direction: row-reverse;
    }

    .logo {
      width: 80px;
      height: 80px;
      border-radius: var(--radius-xl);
      display: grid;
      place-items: center;
      background: linear-gradient(135deg, var(--accent) 0%, #1d4ed8 100%);
      color: white;
      font-weight: 900;
      font-size: 32px;
      letter-spacing: -0.5px;
      position: relative;
      overflow: hidden;
      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 
        0 0 0 1px rgba(var(--accent-rgb), 0.2),
        0 8px 32px rgba(var(--accent-rgb), 0.3),
        var(--shadow);
    }

    .logo::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
      transform: translateX(-100%) rotate(45deg);
      animation: logo-shine 3s ease-in-out infinite;
    }

    @keyframes logo-shine {
      0% { transform: translateX(-100%) rotate(45deg); }
      100% { transform: translateX(200%) rotate(45deg); }
    }

    .logo:hover {
      transform: scale(1.08) rotate(3deg);
      box-shadow: 
        0 0 0 1px rgba(var(--accent-rgb), 0.4),
        0 16px 64px rgba(var(--accent-rgb), 0.4),
        0 32px 80px rgba(0, 0, 0, 0.3);
    }

    h1 {
      font-size: clamp(48px, 5vw, 72px);
      margin: 0;
      font-weight: 800;
      letter-spacing: -0.025em;
      background: linear-gradient(135deg, var(--text) 0%, var(--accent-2) 40%, var(--text) 100%);
      background-size: 200% 200%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: gradient-flow 6s ease-in-out infinite;
      position: relative;
    }

    @keyframes gradient-flow {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    .subtitle {
      color: var(--text-muted);
      text-align: center;
      font-size: 20px;
      font-weight: 400;
      margin: 32px auto 48px;
      max-width: 600px;
      opacity: 0;
      animation: fade-up 1s ease-out 0.3s forwards;
    }

    @keyframes fade-up {
      from {
        opacity: 0;
        transform: translateY(24px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Modern search section */
    .search-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 40px;
    }

    .search-container {
      backdrop-filter: blur(24px);
      -webkit-backdrop-filter: blur(24px);
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-xl);
      padding: 40px;
      position: relative;
      overflow: hidden;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: var(--shadow);
    }

    .search-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(var(--accent-rgb), 0.6), transparent);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .search-container:hover {
      background: var(--glass-hover);
      border-color: rgba(var(--accent-rgb), 0.2);
      transform: translateY(-4px);
      box-shadow: 
        0 0 0 1px rgba(var(--accent-rgb), 0.1),
        0 16px 64px rgba(0, 0, 0, 0.3);
    }

    .search-container:hover::before {
      opacity: 1;
    }

    /* Enhanced search form */
    .search-form {
      display: flex;
      align-items: stretch;
      gap: 20px;
      flex-direction: row-reverse;
      margin-bottom: 32px;
    }

    .search-input-wrapper {
      flex: 1;
      position: relative;
    }

    .search-input {
      width: 100%;
      background: var(--glass);
      backdrop-filter: blur(12px);
      border: 2px solid var(--border);
      border-radius: var(--radius);
      padding: 24px 28px;
      font-size: 18px;
      font-family: inherit;
      color: var(--text);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      z-index: 1;
    }

    .search-input::placeholder {
      color: var(--text-muted);
      font-weight: 300;
    }

    .search-input:focus {
      outline: none;
      border-color: var(--accent);
      background: rgba(var(--accent-rgb), 0.04);
      box-shadow: 
        0 0 0 4px rgba(var(--accent-rgb), 0.12),
        0 8px 32px rgba(var(--accent-rgb), 0.2);
      transform: translateY(-2px);
    }

    .search-input-wrapper::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(var(--accent-rgb), 0.1), transparent);
      border-radius: var(--radius);
      opacity: 0;
      transform: translateX(-100%);
      transition: all 0.6s ease;
      z-index: 0;
    }

    .search-input:focus + .search-input-wrapper::before,
    .search-input-wrapper:hover::before {
      opacity: 1;
      transform: translateX(100%);
    }

    /* Modern buttons */
    .btn {
      appearance: none;
      border: none;
      cursor: pointer;
      border-radius: var(--radius);
      padding: 24px 32px;
      font-weight: 600;
      font-size: 16px;
      font-family: inherit;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      gap: 12px;
      position: relative;
      overflow: hidden;
      white-space: nowrap;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent) 0%, #1d4ed8 100%);
      color: white;
      box-shadow: 
        0 0 0 1px rgba(var(--accent-rgb), 0.2),
        0 8px 24px rgba(var(--accent-rgb), 0.3);
    }

    .btn-primary::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.6s ease;
    }

    .btn-primary:hover:not([disabled]) {
      background: linear-gradient(135deg, #1d4ed8 0%, #1e40af 100%);
      transform: translateY(-3px) scale(1.02);
      box-shadow: 
        0 0 0 1px rgba(var(--accent-rgb), 0.4),
        0 16px 48px rgba(var(--accent-rgb), 0.4);
    }

    .btn-primary:hover:not([disabled])::before {
      left: 100%;
    }

    .btn-secondary {
      background: var(--glass);
      backdrop-filter: blur(12px);
      border: 2px solid var(--border);
      color: var(--text);
    }

    .btn-secondary:hover:not([disabled]) {
      background: var(--glass-hover);
      border-color: rgba(var(--accent-rgb), 0.3);
      transform: translateY(-2px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    }

    .btn[disabled] {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none !important;
    }

    /* Enhanced suggestions */
    .suggestions {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      justify-content: flex-end;
      opacity: 0;
      animation: fade-up 1s ease-out 0.6s forwards;
    }

    .suggestion-chip {
      background: var(--glass);
      backdrop-filter: blur(12px);
      border: 1px solid var(--border);
      color: var(--text-muted);
      padding: 14px 24px;
      border-radius: 50px;
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .suggestion-chip::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: radial-gradient(circle, rgba(var(--accent-rgb), 0.1) 0%, transparent 70%);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      transform: translate(-50%, -50%);
    }

    .suggestion-chip:hover {
      color: var(--text);
      border-color: var(--accent);
      background: rgba(var(--accent-rgb), 0.08);
      transform: translateY(-4px) scale(1.05);
      box-shadow: 
        0 0 0 1px rgba(var(--accent-rgb), 0.2),
        0 8px 32px rgba(var(--accent-rgb), 0.2);
    }

    .suggestion-chip:hover::before {
      width: 200%;
      height: 200%;
    }

    /* Modern content grid */
    .content-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 32px;
      opacity: 0;
      animation: fade-up 1s ease-out 0.9s forwards;
    }

    @media (min-width: 1024px) {
      .content-grid {
        grid-template-columns: 2fr 1fr;
      }
    }

    .panel {
      background: var(--glass);
      backdrop-filter: blur(24px);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-xl);
      padding: 40px;
      height: fit-content;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      box-shadow: var(--shadow);
    }

    .panel::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: linear-gradient(135deg, rgba(var(--accent-rgb), 0.2), transparent, rgba(96, 165, 250, 0.2));
      border-radius: var(--radius-xl);
      opacity: 0;
      transition: opacity 0.4s ease;
      z-index: -1;
    }

    .panel:hover {
      background: var(--glass-hover);
      border-color: rgba(var(--accent-rgb), 0.2);
      transform: translateY(-6px);
      box-shadow: 
        0 0 0 1px rgba(var(--accent-rgb), 0.1),
        0 24px 80px rgba(0, 0, 0, 0.25);
    }

    .panel:hover::before {
      opacity: 1;
    }

    /* Enhanced conversation display */
    .conversation {
      min-height: 400px;
      max-height: 70vh;
      overflow-y: auto;
      scroll-behavior: smooth;
      padding-right: 8px;
    }

    .conversation::-webkit-scrollbar {
      width: 6px;
    }

    .conversation::-webkit-scrollbar-track {
      background: var(--glass);
      border-radius: 3px;
    }

    .conversation::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, var(--accent), var(--accent-2));
      border-radius: 3px;
    }

    .message-label {
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1.2px;
      margin-bottom: 16px;
      color: var(--accent);
      opacity: 0.9;
    }

    .message-bubble {
      background: var(--glass);
      backdrop-filter: blur(16px);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius);
      padding: 28px;
      margin-bottom: 32px;
      line-height: 1.8;
      white-space: pre-wrap;
      word-break: break-word;
      font-size: 16px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .message-bubble::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      transform: scaleX(0);
      transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .message-bubble:hover {
      background: var(--glass-hover);
      border-color: rgba(var(--accent-rgb), 0.2);
      transform: translateX(-4px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
    }

    .message-bubble:hover::before {
      transform: scaleX(1);
    }

    .message-bubble.error {
      border-color: rgba(239, 68, 68, 0.3);
      background: rgba(239, 68, 68, 0.05);
    }

    /* Enhanced status bar */
    .status-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding-bottom: 24px;
      border-bottom: 1px solid var(--border);
      margin-bottom: 32px;
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .status-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--accent);
      box-shadow: 0 0 16px var(--accent);
      animation: pulse-dot 2s infinite;
    }

    @keyframes pulse-dot {
      0%, 100% {
        opacity: 1;
        transform: scale(1);
        box-shadow: 0 0 16px var(--accent);
      }
      50% {
        opacity: 0.7;
        transform: scale(1.2);
        box-shadow: 0 0 24px var(--accent);
      }
    }

    .copy-btn {
      font-size: 13px;
      padding: 12px 20px;
      border-radius: var(--radius);
      background: var(--glass);
      backdrop-filter: blur(12px);
      border: 1px solid var(--border);
      color: var(--text-muted);
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      font-weight: 600;
    }

    .copy-btn:hover {
      color: var(--text);
      border-color: var(--accent);
      background: rgba(var(--accent-rgb), 0.08);
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(var(--accent-rgb), 0.2);
    }

    /* Modern thinking indicator */
    .thinking-indicator {
      background: var(--glass);
      border: 2px solid var(--accent);
      animation: thinking-pulse 2s infinite;
      position: relative;
    }

    @keyframes thinking-pulse {
      0%, 100% {
        border-color: var(--accent);
        box-shadow: 0 0 20px rgba(var(--accent-rgb), 0.2);
      }
      50% {
        border-color: var(--accent-2);
        box-shadow: 0 0 32px rgba(96, 165, 250, 0.3);
      }
    }

    .thinking-dots {
      display: flex;
      gap: 8px;
      justify-content: center;
      margin-bottom: 16px;
    }

    .thinking-dot {
      width: 10px;
      height: 10px;
      background: var(--accent);
      border-radius: 50%;
      animation: thinking-bounce 1.4s infinite both;
    }

    .thinking-dot:nth-child(1) { animation-delay: -0.32s; }
    .thinking-dot:nth-child(2) { animation-delay: -0.16s; }

    @keyframes thinking-bounce {
      0%, 80%, 100% {
        transform: scale(0.8);
        opacity: 0.5;
      }
      40% {
        transform: scale(1.3);
        opacity: 1;
      }
    }

    /* Enhanced links */
    .inline-link {
      color: var(--accent);
      text-decoration: none;
      padding: 6px 12px;
      border-radius: 12px;
      background: rgba(var(--accent-rgb), 0.1);
      border: 1px solid rgba(var(--accent-rgb), 0.2);
      font-size: 14px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      margin: 0 4px;
      position: relative;
      overflow: hidden;
    }

    .inline-link::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      transition: left 0.4s ease;
    }

    .inline-link:hover {
      color: white;
      background: var(--accent);
      border-color: var(--accent);
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 32px rgba(var(--accent-rgb), 0.3);
    }

    .inline-link:hover::before {
      left: 100%;
    }

    .inline-link::after {
      content: "↗";
      font-size: 12px;
      opacity: 0.8;
      transition: all 0.3s ease;
    }

    .inline-link:hover::after {
      opacity: 1;
      transform: translate(2px, -2px);
    }

    /* Enhanced spinner */
    .spinner {
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255,255,255,0.2);
      border-top: 2px solid var(--accent);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Modern sidebar */
    .sidebar-title {
      margin: 0 0 28px 0;
      font-size: 22px;
      font-weight: 700;
      color: var(--text);
      background: linear-gradient(135deg, var(--text), var(--accent-2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .history-list {
      display: grid;
      gap: 20px;
    }

    .history-item {
      background: var(--glass);
      backdrop-filter: blur(12px);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 24px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .history-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(var(--accent-rgb), 0.05), transparent);
      transition: left 0.5s ease;
    }

    .history-item:hover {
      border-color: rgba(var(--accent-rgb), 0.3);
      background: var(--glass-hover);
      transform: translateY(-3px);
      box-shadow: 0 8px 32px rgba(var(--accent-rgb), 0.15);
    }

    .history-item:hover::before {
      left: 100%;
    }

    .history-query {
      font-weight: 600;
      margin-bottom: 12px;
    }

    .history-time {
      color: var(--text-muted);
      font-size: 13px;
      margin-bottom: 16px;
    }

    /* Enhanced scroll indicator */
    .scroll-indicator {
      position: fixed;
      bottom: 32px;
      right: 32px;
      width: 56px;
      height: 56px;
      background: linear-gradient(135deg, var(--accent) 0%, #1d4ed8 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 100;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      opacity: 0;
      transform: translateY(20px) scale(0.8);
      box-shadow: 
        0 0 0 1px rgba(var(--accent-rgb), 0.2),
        0 8px 32px rgba(var(--accent-rgb), 0.3);
    }

    .scroll-indicator.show {
      opacity: 1;
      transform: translateY(0) scale(1);
    }

    .scroll-indicator:hover {
      transform: scale(1.1);
      box-shadow: 
        0 0 0 1px rgba(var(--accent-rgb), 0.4),
        0 16px 48px rgba(var(--accent-rgb), 0.4);
    }

    .scroll-indicator::after {
      content: "⬇";
      color: white;
      font-size: 24px;
      animation: bounce-down 2s infinite;
    }

    @keyframes bounce-down {
      0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
      40% { transform: translateY(4px); }
      60% { transform: translateY(2px); }
    }

    /* Light mode adaptations */
    @media (prefers-color-scheme: light) {
      :root {
        --bg: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        --glass: rgba(255, 255, 255, 0.7);
        --glass-border: rgba(255, 255, 255, 0.8);
        --glass-hover: rgba(255, 255, 255, 0.85);
        --text: #1e293b;
        --text-muted: #64748b;
        --border: rgba(148, 163, 184, 0.2);
        --shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
        --shadow-xl: 0 25px 50px rgba(0, 0, 0, 0.12);
      }

      body::before {
        background: 
          radial-gradient(circle at 25% 25%, rgba(var(--accent-rgb), 0.04) 0%, transparent 50%),
          radial-gradient(circle at 75% 75%, rgba(96, 165, 250, 0.03) 0%, transparent 50%);
      }
    }

    /* Mobile responsiveness */
    @media (max-width: 768px) {
      .container {
        padding: 0 16px;
      }
      
      .header {
        padding: 40px 0 32px;
      }
      
      h1 {
        font-size: clamp(36px, 8vw, 48px);
      }
      
      .logo {
        width: 64px;
        height: 64px;
        font-size: 26px;
      }
      
      .search-container {
        padding: 24px;
      }
      
      .search-form {
        flex-direction: column;
        gap: 16px;
      }
      
      .suggestions {
        justify-content: center;
      }
      
      .suggestion-chip {
        font-size: 14px;
        padding: 12px 20px;
      }

      .panel {
        padding: 24px;
      }

      .scroll-indicator {
        bottom: 24px;
        right: 24px;
        width: 48px;
        height: 48px;
      }

      .brand {
        gap: 24px;
      }
    }

    @media (max-width: 480px) {
      .search-form .btn {
        padding: 20px 24px;
        font-size: 15px;
      }

      .search-input {
        padding: 20px 24px;
        font-size: 16px;
      }

      .content-grid {
        gap: 24px;
      }
    }

    /* Focus states for accessibility */
    .btn:focus-visible, 
    .suggestion-chip:focus-visible, 
    .copy-btn:focus-visible,
    .search-input:focus-visible {
      outline: 3px solid rgba(var(--accent-rgb), 0.5);
      outline-offset: 2px;
    }

    /* Reduced motion preferences */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
      
      .scroll-indicator {
        animation: none;
      }
      
      .thinking-dot {
        animation: none;
      }
    }

    /* High contrast mode */
    @media (prefers-contrast: high) {
      :root {
        --glass: rgba(0, 0, 0, 0.9);
        --glass-border: rgba(255, 255, 255, 0.3);
        --border: rgba(255, 255, 255, 0.5);
      }
    }

    /* Print styles */
    @media print {
      body::before,
      .scroll-indicator,
      .search-container,
      .sidebar {
        display: none !important;
      }
      
      .panel {
        break-inside: avoid;
        box-shadow: none;
        border: 1px solid #ccc;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="brand">
        <h1>المقاول</h1>
        <div class="logo">م</div>
      </div>
    </header>

    <div class="subtitle">محرك بحث ذكي للمقاولين والأعمال التجارية</div>

    <main class="search-section">
      <div class="search-container">
        <form id="search-form" class="search-form" autocomplete="off">
          <div class="search-input-wrapper">
            <input id="q" name="q" class="search-input" placeholder="اكتب سؤالك هنا…" required />
          </div>
          <button id="submit-btn" class="btn btn-primary" type="submit">
            <span>ابحث</span>
          </button>
          <button type="button" id="clear" class="btn btn-secondary">محو</button>
        </form>
        
        <div class="suggestions" id="chips">
          <span class="suggestion-chip">ما هو المقاول الذاتي؟</span>
          <span class="suggestion-chip">كيفية إنشاء خطة عمل؟</span>
          <span class="suggestion-chip">أفكار مشاريع ناجحة</span>
          <span class="suggestion-chip">مصادر تمويل المشاريع</span>
        </div>
      </div>

      <div class="content-grid" id="main-content">
        <section class="panel" id="results">
          <div class="status-bar">
            <div class="status-indicator">
              <span class="status-dot"></span> 
              <span id="status-text">جاهز</span>
            </div>
            <button id="copy-last" class="copy-btn">نسخ آخر إجابة</button>
          </div>
          <div id="conversation" class="conversation"></div>
        </section>

        <aside class="panel sidebar">
          <h3 class="sidebar-title">السجل المحلي</h3>
          <div id="history" class="history-list"></div>
          <div style="height: 1px; background: linear-gradient(90deg, transparent, var(--border), transparent); margin: 24px 0;"></div>
          <button id="clear-history" class="btn btn-secondary" style="width: 100%;">مسح السجل</button>
        </aside>
      </div>
    </main>

    <!-- Scroll to results indicator -->
    <div class="scroll-indicator" id="scroll-indicator"></div>
  </div>

  <script>
    // Configuration - Update this URL for production
    const WEBHOOK_URL = window.location.hostname === 'localhost' 
      ? "http://localhost:5678/webhook-test/247924dc-d09c-44bb-b062-033b71738f7f"
      : "https://your-production-webhook-url.com/webhook/your-id";
    const REQUEST_TIMEOUT = 60000;

    // Enhanced auto-scroll functionality
    const autoScrollToResults = () => {
      const resultsSection = document.getElementById('main-content');
      const scrollIndicator = document.getElementById('scroll-indicator');
      
      scrollIndicator.classList.add('show');
      
      const offsetPosition = resultsSection.offsetTop - 80;
      
      window.scrollTo({
        top: offsetPosition,
        behavior: 'smooth'
      });
      
      setTimeout(() => {
        scrollIndicator.classList.remove('show');
      }, 2000);
    };

    const autoScrollConversation = () => {
      const conversationContainer = document.getElementById("conversation");
      conversationContainer.scrollTo({
        top: conversationContainer.scrollHeight,
        behavior: 'smooth'
      });
    };

    const updateStatus = (text, loading = false) => {
      const statusElement = document.getElementById("status-text");
      statusElement.textContent = text;
      
      const existingSpinner = statusElement.querySelector(".spinner");
      if (existingSpinner) existingSpinner.remove();
      
      if (loading) {
        const spinner = document.createElement("span");
        spinner.className = "spinner";
        spinner.style.marginLeft = "12px";
        statusElement.appendChild(spinner);
      }
    };

    let searchHistory = [];

    const saveToHistory = (item) => {
      searchHistory.unshift(item);
      searchHistory = searchHistory.slice(0, 50);
      renderHistory();
    };

    const renderHistory = () => {
      const historyContainer = document.getElementById("history");
      historyContainer.innerHTML = "";
      
      if (!searchHistory.length) {
        historyContainer.innerHTML = "<div style='color: var(--text-muted); text-align: center; padding: 20px;'>السجل فارغ. ستظهر آخر 50 عملية بحث هنا.</div>";
        return;
      }
      
      searchHistory.forEach(item => {
        const historyItem = document.createElement("div");
        historyItem.className = "history-item";
        
        const query = document.createElement("div");
        query.className = "history-query";
        query.textContent = item.q;
        
        const time = document.createElement("div");
        time.className = "history-time";
        time.textContent = new Date(item.t).toLocaleString("ar-MA");
        
        const repeatBtn = document.createElement("button");
        repeatBtn.className = "btn btn-secondary";
        repeatBtn.textContent = "أعد البحث";
        repeatBtn.style.fontSize = "13px";
        repeatBtn.style.padding = "8px 16px";
        repeatBtn.onclick = () => {
          document.getElementById("q").value = item.q;
          document.getElementById("search-form").dispatchEvent(new Event("submit"));
        };
        
        historyItem.appendChild(query);
        historyItem.appendChild(time);
        historyItem.appendChild(repeatBtn);
        historyContainer.appendChild(historyItem);
      });
    };

    const cleanResponse = (rawData) => {
      let response = "";
      
      if (typeof rawData === "string") {
        try {
          const parsed = JSON.parse(rawData);
          response = parsed.completion || parsed.answer || parsed.data || parsed.text || rawData;
        } catch {
          response = rawData;
        }
      } else if (rawData && typeof rawData === "object") {
        response = rawData.completion || rawData.answer || rawData.data || rawData.text || JSON.stringify(rawData, null, 2);
      }
      
      return response.trim();
    };

    const makeLinksClickable = (text) => {
      if (text.includes('<a href=') || text.includes('</a>')) {
        return text;
      }

      const urlRegex = /(https?:\/\/[^\s<>"()[\]]+)/g;
      return text.replace(urlRegex, (url) => {
        try {
          let cleanUrl = url.replace(/[)}\].,;:!?]+$/, '');
          
          if (cleanUrl.length < 8) {
            return url;
          }
          
          let urlObj;
          try {
            urlObj = new URL(cleanUrl);
          } catch {
            return url;
          }
          
          const domain = urlObj.hostname.replace('www.', '');
          
          if (domain.includes('localhost') || 
              domain.includes('127.0.0.1') || 
              domain.includes('192.168.') ||
              domain.includes('10.0.') ||
              domain.includes('172.')) {
            return url;
          }
          
          const linkId = 'link_' + Math.random().toString(36).substr(2, 9);
          
          return `<a id="${linkId}" href="${cleanUrl}" target="_blank" rel="noopener noreferrer" class="inline-link" onclick="event.preventDefault(); window.open('${cleanUrl}', '_blank', 'noopener,noreferrer'); return false;" style="cursor: pointer;">${domain}</a>`;
          
        } catch (e) {
          console.warn('Invalid URL detected:', url, e);
          return url;
        }
      });
    };

    const typeText = async (element, text, speed = 15) => {
      element.innerHTML = "";
      const characters = text.split("");
      let currentText = "";
      
      for (let i = 0; i < characters.length; i++) {
        const char = characters[i];
        currentText += char;
        
        element.innerHTML = makeLinksClickable(currentText);
        
        autoScrollConversation();
        
        const delay = char === '.' || char === '!' || char === '?' 
          ? speed * 8 
          : char === ',' || char === ';' 
          ? speed * 4 
          : char === ' ' 
          ? speed * 1.5
          : speed;
          
        await new Promise(resolve => setTimeout(resolve, delay));
      }
      
      setTimeout(autoScrollConversation, 100);
    };

    const addMessage = async (text, role = "user", sources = []) => {
      const conversation = document.getElementById("conversation");
      
      const label = document.createElement("div");
      label.className = "message-label";
      label.textContent = role === "user" ? "أنت" : role === "error" ? "خطأ" : "المساعد";
      conversation.appendChild(label);

      const bubble = document.createElement("div");
      bubble.className = "message-bubble" + (role === "error" ? " error" : "");
      
      if (role === "ai") {
        conversation.appendChild(bubble);
        autoScrollConversation();
        await typeText(bubble, text, 12);
      } else {
        bubble.textContent = text;
        conversation.appendChild(bubble);
        autoScrollConversation();
      }

      if (role === "ai" && sources.length) {
        const sourcesLabel = document.createElement("div");
        sourcesLabel.className = "message-label";
        sourcesLabel.style.marginTop = "24px";
        sourcesLabel.textContent = "مصادر";
        
        const sourcesContainer = document.createElement("div");
        sourcesContainer.className = "history-list";
        
        sources.forEach(source => {
          const sourceItem = document.createElement("div");
          sourceItem.className = "history-item";
          
          const sourceLink = document.createElement("a");
          sourceLink.href = source.url; 
          sourceLink.target = "_blank"; 
          sourceLink.rel = "noreferrer noopener";
          sourceLink.textContent = source.title;
          sourceLink.style.color = "var(--accent)";
          sourceLink.style.textDecoration = "none";
          sourceLink.style.fontWeight = "600";
          
          sourceItem.appendChild(sourceLink);
          sourcesContainer.appendChild(sourceItem);
        });
        
        conversation.appendChild(sourcesLabel);
        conversation.appendChild(sourcesContainer);
        autoScrollConversation();
      }

      conversation.dataset.lastResponse = text;
    };

    const callWebhook = async (question) => {
      const controller = new AbortController();
      const timer = setTimeout(() => controller.abort(), REQUEST_TIMEOUT);
      
      try {
        const response = await fetch(WEBHOOK_URL, {
          method: "POST",
          headers: { 
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ question }),
          signal: controller.signal
        });

        clearTimeout(timer);
        
        if (!response.ok) {
          const errorText = await response.text().catch(() => "");
          throw new Error(`خطأ في الخدمة (${response.status}) — ${errorText || "خطأ في الطلب"}`);
        }
        
        const contentType = response.headers.get("content-type") || "";
        return contentType.includes("application/json") ? response.json() : response.text();
        
      } catch (error) {
        clearTimeout(timer);
        
        if (error.name === 'AbortError') {
          throw new Error('انتهت مهلة الطلب. يرجى المحاولة مرة أخرى.');
        }
        
        if (!navigator.onLine) {
          throw new Error('لا يوجد اتصال بالإنترنت. يرجى التحقق من اتصالك.');
        }
        
        throw new Error('خطأ في الاتصال بالخدمة. يرجى المحاولة لاحقاً.');
      }
    };

    // Enhanced event listeners
    document.getElementById("search-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const query = document.getElementById("q").value.trim();
      if (!query) return;
      
      const submitBtn = document.getElementById("submit-btn");
      const inputElement = document.getElementById("q");
      
      inputElement.value = "";
      submitBtn.disabled = true;
      
      setTimeout(autoScrollToResults, 300);
      
      await addMessage(query, "user");
      
      updateStatus("المساعد يفكر في الإجابة...", true);
      
      // Add thinking indicator
      const conversation = document.getElementById("conversation");
      const thinkingLabel = document.createElement("div");
      thinkingLabel.className = "message-label";
      thinkingLabel.textContent = "المساعد";
      thinkingLabel.id = "thinking-label";
      
      const thinkingBubble = document.createElement("div");
      thinkingBubble.className = "message-bubble thinking-indicator";
      thinkingBubble.id = "thinking-bubble";
      thinkingBubble.innerHTML = `
        <div class="thinking-dots">
          <span class="thinking-dot"></span>
          <span class="thinking-dot"></span>
          <span class="thinking-dot"></span>
        </div>
        <div style="text-align: center; color: var(--text-muted); font-size: 14px; margin-top: 8px;">
          يتم تحليل السؤال وإعداد الإجابة...
        </div>
      `;
      
      conversation.appendChild(thinkingLabel);
      conversation.appendChild(thinkingBubble);
      autoScrollConversation();

      try {
        const rawResponse = await callWebhook(query);
        const answer = cleanResponse(rawResponse);
        let sources = [];
        
        if (rawResponse && typeof rawResponse === "object" && Array.isArray(rawResponse.sources)) {
          sources = rawResponse.sources.map(s => 
            typeof s === "string" 
              ? { title: s, url: s } 
              : { title: s.title || s.url, url: s.url || "#" }
          );
        }
        
        // Remove thinking indicators
        document.getElementById("thinking-label")?.remove();
        document.getElementById("thinking-bubble")?.remove();
        
        await addMessage(answer, "ai", sources);
        saveToHistory({ q: query, t: Date.now() });
        updateStatus("تم الانتهاء", false);
        
      } catch(error) {
        console.error(error);
        
        document.getElementById("thinking-label")?.remove();
        document.getElementById("thinking-bubble")?.remove();
        
        await addMessage(error.message, "error");
        updateStatus("حدث خطأ", false);
        
      } finally {
        submitBtn.disabled = false;
      }
    });

    document.getElementById("clear").onclick = () => {
      const input = document.getElementById("q");
      const conversation = document.getElementById("conversation");
      
      input.value = "";
      conversation.innerHTML = "";
      updateStatus("جاهز");
      input.focus();
    };

    document.getElementById("copy-last").onclick = () => {
      const lastResponse = document.getElementById("conversation").dataset.lastResponse || "";
      if (!lastResponse) {
        alert("لا توجد إجابة للنسخ.");
        return;
      }
      
      navigator.clipboard.writeText(lastResponse)
        .then(() => {
          const btn = document.getElementById("copy-last");
          const originalText = btn.textContent;
          btn.textContent = "تم النسخ!";
          btn.style.background = "var(--accent)";
          btn.style.color = "white";
          
          setTimeout(() => {
            btn.textContent = originalText;
            btn.style.background = "";
            btn.style.color = "";
          }, 2000);
        })
        .catch(() => alert("النسخ فشل."));
    };

    document.getElementById("chips").onclick = (e) => {
      const chip = e.target.closest(".suggestion-chip");
      if (!chip) return;
      
      chip.style.transform = "scale(0.95)";
      setTimeout(() => {
        chip.style.transform = "";
        const input = document.getElementById("q");
        input.value = chip.textContent.trim();
        input.focus();
      }, 150);
    };

    document.getElementById("clear-history").onclick = () => {
      if (confirm("هل أنت متأكد من مسح السجل؟")) {
        searchHistory = [];
        renderHistory();
      }
    };

    document.getElementById("scroll-indicator").onclick = () => {
      autoScrollToResults();
    };

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      renderHistory();
      
      const elements = document.querySelectorAll('.search-container, .panel');
      elements.forEach((el, index) => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(20px)';
        setTimeout(() => {
          el.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
          el.style.opacity = '1';
          el.style.transform = 'translateY(0)';
        }, 200 + (index * 100));
      });
      
      setTimeout(() => {
        document.getElementById("q").focus();
      }, 1000);
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
        e.preventDefault();
        document.getElementById("q").focus();
      }
      
      if (e.key === 'Escape') {
        document.getElementById("q").blur();
      }
    });

    // Enhanced scroll behavior
    let scrollTimeout;
    window.addEventListener('scroll', () => {
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(() => {
        const scrollIndicator = document.getElementById('scroll-indicator');
        const resultsSection = document.getElementById('main-content');
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        const resultsPosition = resultsSection.offsetTop - 150;
        
        const hasContent = document.getElementById('conversation').children.length > 0;
        
        if (scrollTop < resultsPosition && hasContent) {
          scrollIndicator.classList.add('show');
        } else {
          scrollIndicator.classList.remove('show');
        }
      }, 100);
    });

    // Force external links to open in new window
    document.addEventListener('click', function(event) {
      const target = event.target.closest('.inline-link');
      if (target && target.onclick) {
        event.preventDefault();
        event.stopPropagation();
        target.onclick();
        return false;
      }
    });
  </script>
</body>
</html>
